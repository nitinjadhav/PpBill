<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Newspaper Bill Calculator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 900px; margin: auto; }
    table, th, td { border: 1px solid #aaa; border-collapse: collapse; padding: 6px; text-align: center; }
    input[type="number"], input[type="text"], select { width: 100%; padding: 4px; box-sizing: border-box; }
    button { padding: 6px 12px; margin: 6px 4px 0 0; cursor: pointer; }
    .no-print { margin-top: 15px; }
    @media print {
      .no-print { display: none; }
    }
  </style>
</head>
<body>
  <h2 data-txt="title">üóûÔ∏è Newspaper Bill Calculator</h2>

  <div class="no-print">
    <label data-txt="selectMonth">Select Month & Year:</label>
    <select id="monthSelect"></select>
    <select id="yearSelect"></select>
    <button onclick="calculateWeekdays()">üìÖ <span data-txt="getWeekdays">Get Weekdays</span></button>

    <label style="float:right;">
      üåê <span data-txt="language">Language</span>:
      <select onchange="changeLanguage(this.value)">
        <option value="en">English</option>
        <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
        <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
      </select>
    </label>
  </div>

  <div id="weekdaySummary" style="margin: 15px 0;"></div>

  <table id="paperTable">
    <thead>
      <tr>
        <th data-txt="paper">Paper Name</th>
        <th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th>
        <th data-txt="total">Total (‚Çπ)</th>
        <th class="no-print" data-txt="action">Action</th>
      </tr>
    </thead>
    <tbody id="paperBody"></tbody>
  </table>

  <div class="no-print">
    <button onclick="addPaper()">‚ûï <span data-txt="addPaper">Add Newspaper</span></button>
  </div>

  <br/>
  <label data-txt="agency">Agency Charges (‚Çπ):</label>
  <input type="number" id="agencyCharge" value="0" oninput="calculateTotal()" />

  <br/>
  <label data-txt="adjust">Adjustments (+/- ‚Çπ):</label>
  <input type="number" id="adjustment" value="0" oninput="calculateTotal()" />

  <h3><span data-txt="grand">Grand Total</span>: ‚Çπ<span id="grandTotal">0.00</span></h3>

  <div class="no-print">
    <button onclick="saveData()">üíæ <span data-txt="save">Save</span></button>
    <button onclick="downloadExcel()">‚¨áÔ∏è <span data-txt="excel">Excel</span></button>
    <button onclick="exportToWhatsApp()">üì≤ WhatsApp</button>
    <button onclick="window.print()">üñ®Ô∏è <span data-txt="print">Print / PDF</span></button>
  </div>

  <script>
    const weekdayCounts = { Mon: 0, Tue: 0, Wed: 0, Thu: 0, Fri: 0, Sat: 0, Sun: 0 };

    const languageStrings = {
      en: {
        title: "Newspaper Bill Calculator",
        selectMonth: "Select Month & Year:",
        getWeekdays: "Get Weekdays",
        addPaper: "Add Newspaper",
        paper: "Paper Name",
        total: "Total (‚Çπ)",
        action: "Action",
        agency: "Agency Charges (‚Çπ):",
        adjust: "Adjustments (+/- ‚Çπ):",
        grand: "Grand Total",
        save: "Save",
        excel: "Excel",
        print: "Print / PDF",
        language: "Language"
      },
      hi: {
        title: "‡§Ö‡§ñ‡§¨‡§æ‡§∞ ‡§¨‡§ø‡§≤ ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞",
        selectMonth: "‡§Æ‡§æ‡§π ‡§î‡§∞ ‡§µ‡§∞‡•ç‡§∑ ‡§ö‡•Å‡§®‡•á‡§Ç:",
        getWeekdays: "‡§∏‡§™‡•ç‡§§‡§æ‡§π ‡§ï‡•á ‡§¶‡§ø‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç",
        addPaper: "‡§Ö‡§ñ‡§¨‡§æ‡§∞ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç",
        paper: "‡§Ö‡§ñ‡§¨‡§æ‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ",
        total: "‡§ï‡•Å‡§≤ (‚Çπ)",
        action: "‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ",
        agency: "‡§è‡§ú‡•á‡§Ç‡§∏‡•Ä ‡§∂‡•Å‡§≤‡•ç‡§ï (‚Çπ):",
        adjust: "‡§∏‡§Æ‡§æ‡§Ø‡•ã‡§ú‡§® (+/- ‚Çπ):",
        grand: "‡§ï‡•Å‡§≤ ‡§Ø‡•ã‡§ó",
        save: "‡§∏‡§π‡•á‡§ú‡•á‡§Ç",
        excel: "‡§è‡§ï‡•ç‡§∏‡•á‡§≤",
        print: "‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü / ‡§™‡•Ä‡§°‡•Ä‡§è‡§´",
        language: "‡§≠‡§æ‡§∑‡§æ"
      },
      mr: {
        title: "‡§µ‡•É‡§§‡•ç‡§§‡§™‡§§‡•ç‡§∞ ‡§¨‡§ø‡§≤ ‡§ï‡•Ö‡§≤‡•ç‡§ï‡•ç‡§Ø‡•Å‡§≤‡•á‡§ü‡§∞",
        selectMonth: "‡§Æ‡§π‡§ø‡§®‡§æ ‡§µ ‡§µ‡§∞‡•ç‡§∑ ‡§®‡§ø‡§µ‡§°‡§æ:",
        getWeekdays: "‡§Ü‡§†‡§µ‡§°‡•ç‡§Ø‡§æ‡§ö‡•á ‡§¶‡§ø‡§µ‡§∏ ‡§Æ‡§ø‡§≥‡§µ‡§æ",
        addPaper: "‡§µ‡•É‡§§‡•ç‡§§‡§™‡§§‡•ç‡§∞ ‡§ú‡•ã‡§°‡§æ",
        paper: "‡§µ‡•É‡§§‡•ç‡§§‡§™‡§§‡•ç‡§∞‡§æ‡§ö‡•á ‡§®‡§æ‡§µ",
        total: "‡§è‡§ï‡•Ç‡§£ (‚Çπ)",
        action: "‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ",
        agency: "‡§è‡§ú‡§®‡•ç‡§∏‡•Ä ‡§∂‡•Å‡§≤‡•ç‡§ï (‚Çπ):",
        adjust: "‡§∏‡§Æ‡§æ‡§Ø‡•ã‡§ú‡§® (+/- ‚Çπ):",
        grand: "‡§è‡§ï‡•Ç‡§£ ‡§∞‡§ï‡•ç‡§ï‡§Æ",
        save: "‡§∏‡§æ‡§†‡§µ‡§æ",
        excel: "‡§è‡§ï‡•ç‡§∏‡•á‡§≤",
        print: "‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü / ‡§™‡•Ä‡§°‡•Ä‡§è‡§´",
        language: "‡§≠‡§æ‡§∑‡§æ"
      }
    };

    function changeLanguage(lang) {
      document.querySelectorAll("[data-txt]").forEach(el => {
        const key = el.getAttribute("data-txt");
        el.innerText = languageStrings[lang][key];
      });
    }

    function initMonthYear() {
      const monthSel = document.getElementById("monthSelect");
      const yearSel = document.getElementById("yearSelect");
      const now = new Date();
      for (let m = 0; m < 12; m++) {
        const opt = new Option(new Date(0, m).toLocaleString('default', { month: 'long' }), m);
        monthSel.appendChild(opt);
      }
      for (let y = now.getFullYear() - 5; y <= now.getFullYear() + 5; y++) {
        const opt = new Option(y, y);
        yearSel.appendChild(opt);
      }
      monthSel.value = now.getMonth();
      yearSel.value = now.getFullYear();
    }

    function calculateWeekdays() {
      for (let day in weekdayCounts) weekdayCounts[day] = 0;
      const month = parseInt(document.getElementById("monthSelect").value);
      const year = parseInt(document.getElementById("yearSelect").value);
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      for (let d = 1; d <= daysInMonth; d++) {
        const date = new Date(year, month, d);
        const wd = date.toLocaleDateString('en-US', { weekday: 'short' });
        if (wd.startsWith("Mon")) weekdayCounts.Mon++;
        else if (wd.startsWith("Tue")) weekdayCounts.Tue++;
        else if (wd.startsWith("Wed")) weekdayCounts.Wed++;
        else if (wd.startsWith("Thu")) weekdayCounts.Thu++;
        else if (wd.startsWith("Fri")) weekdayCounts.Fri++;
        else if (wd.startsWith("Sat")) weekdayCounts.Sat++;
        else if (wd.startsWith("Sun")) weekdayCounts.Sun++;
      }
      const summary = Object.entries(weekdayCounts).map(([d, c]) => `${d}: ${c}`).join(" | ");
      document.getElementById("weekdaySummary").innerText = `üóìÔ∏è Weekdays in selected month: ${summary}`;
      const key = `${month}-${year}`;
      const data = JSON.parse(localStorage.getItem("bill-" + key) || "[]");
      document.getElementById("paperBody").innerHTML = "";
      if (data.length > 0) data.forEach(addPaper);
      else addPaper();
      document.getElementById("agencyCharge").value = localStorage.getItem("agency-" + key) || 0;
      document.getElementById("adjustment").value = localStorage.getItem("adjust-" + key) || 0;
      calculateTotal();
    }

    function addPaper(paper = {}) {
      const table = document.getElementById("paperBody");
      const row = table.insertRow();
      const days = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
      let html = `<td><input type="text" value="${paper.name || ""}" /></td>`;
      days.forEach(d => html += `<td><input type="number" min="0" value="${paper[d] || 0}" oninput="calculateTotal()" /></td>`);
      html += `<td class="paper-total">0.00</td><td class="no-print"><button onclick="row.remove(); calculateTotal()">üóëÔ∏è</button></td>`;
      row.innerHTML = html;
      calculateTotal();
    }

    function calculateTotal() {
      let grand = 0;
      document.querySelectorAll("#paperBody tr").forEach(row => {
        const inputs = row.querySelectorAll("input");
        let total = 0;
        ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"].forEach((d, i) => {
          total += (parseFloat(inputs[i + 1].value) || 0) * weekdayCounts[d];
        });
        row.querySelector(".paper-total").innerText = total.toFixed(2);
        grand += total;
      });
      const agency = parseFloat(document.getElementById("agencyCharge").value) || 0;
      const adjust = parseFloat(document.getElementById("adjustment").value) || 0;
      document.getElementById("grandTotal").innerText = (grand + agency + adjust).toFixed(2);
    }

    function saveData() {
      const month = document.getElementById("monthSelect").value;
      const year = document.getElementById("yearSelect").value;
      const key = `${month}-${year}`;
      const rows = document.querySelectorAll("#paperBody tr");
      const data = [];
      rows.forEach(row => {
        const inputs = row.querySelectorAll("input");
        const obj = { name: inputs[0].value };
        ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"].forEach((d, i) => obj[d] = inputs[i + 1].value);
        data.push(obj);
      });
      localStorage.setItem("bill-" + key, JSON.stringify(data));
      localStorage.setItem("agency-" + key, document.getElementById("agencyCharge").value);
      localStorage.setItem("adjust-" + key, document.getElementById("adjustment").value);
      alert("‚úÖ Data saved for this month.");
    }

    function downloadExcel() {
      const rows = [["Paper", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun", "Total"]];
      document.querySelectorAll("#paperBody tr").forEach(row => {
        const inputs = row.querySelectorAll("input");
        const paper = inputs[0].value;
        const values = Array.from(inputs).slice(1).map(i => i.value);
        const total = row.querySelector(".paper-total").innerText;
        rows.push([paper, ...values, total]);
      });
      rows.push(["", "", "", "", "", "", "", "Agency", document.getElementById("agencyCharge").value]);
      rows.push(["", "", "", "", "", "", "", "Adjustment", document.getElementById("adjustment").value]);
      rows.push(["", "", "", "", "", "", "", "Grand Total", document.getElementById("grandTotal").innerText]);
      const sheet = XLSX.utils.aoa_to_sheet(rows);
      const book = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(book, sheet, "Bill");
      XLSX.writeFile(book, "Newspaper_Bill.xlsx");
    }

    function exportToWhatsApp() {
      let msg = "üì∞ Newspaper Bill Summary:\n";
      document.querySelectorAll("#paperBody tr").forEach(row => {
        const name = row.querySelector("input").value;
        const total = row.querySelector(".paper-total").innerText;
        if (name) msg += `‚Ä¢ ${name}: ‚Çπ${total}\n`;
      });
      msg += `\nAgency Charges: ‚Çπ${document.getElementById("agencyCharge").value}`;
      msg += `\nAdjustments: ‚Çπ${document.getElementById("adjustment").value}`;
      msg += `\nüßæ Grand Total: ‚Çπ${document.getElementById("grandTotal").innerText}`;
      const encoded = encodeURIComponent(msg);
      window.open(`https://wa.me/?text=${encoded}`, "_blank");
    }

    window.onload = () => {
      initMonthYear();
      calculateWeekdays();
      changeLanguage("en");
    };
  </script>
</body>
</html>
